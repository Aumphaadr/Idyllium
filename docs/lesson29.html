<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 23: Работа с файлами — Idyllium</title>
    <link rel="stylesheet" href="./fonts/fonts.css">
    <link rel="stylesheet" href="./style.css">
    <style>
        .file {
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            padding: 1em;
            border-radius: 0.5em;
            font-family: 'Source Code Pro', monospace;
            white-space: pre;
            margin: 1em 0;
            color: #333;
        }
    </style>
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon">
</head>
<body>
    <header id="shared-header"></header>
    <main>
        <section>
            <h1>Урок 23: Работа с файлами</h1>
            <p class="subtitle">Как сохранить результаты программы и читать внешние данные</p>
        </section>
        <section class="flex">
            <div id="lessons-nav-placeholder"></div>
            <div class="examples">
                <div class="example">
                    <h2>Зачем нужны файлы?</h2>
                    <p>До сих пор всё, что делала ваша программа, исчезало после её завершения. Чтобы сохранить данные надолго — их нужно записать в файл.</p>
                    <p>Файлы позволяют:</p>
                    <ul>
                        <li>Сохранять результаты работы (например, таблицу рекордов);</li>
                        <li>Загружать настройки или уровень игры;</li>
                        <li>Обмениваться данными между программами.</li>
                    </ul>
                </div>
                <div class="example">
                    <h2>Библиотека <code>file</code></h2>
                    <p>Для работы с файлами в Idyllium используется встроенная библиотека <code>file</code>:</p>
                    <pre><span class="keyword">use</span> <span class="object">file</span><span class="brackets">;</span></pre>
                    <p>Она предоставляет два типа потоков:</p>
                    <ul>
                        <li><code>file.ostream</code> — для записи в файл (output stream);</li>
                        <li><code>file.istream</code> — для чтения из файла (input stream).</li>
                    </ul>
                </div>
                <div class="example">
                    <h2>Открытие файла для записи</h2>
                    <p>Чтобы записывать данные в файл, нужно сначала открыть его функцией <code>file.open()</code>:</p>
                    <pre><span class="object">file</span><span class="brackets">.</span><span class="className">ostream</span> <span class="object">fout</span> <span class="brackets">=</span> <span class="object">file</span><span class="brackets">.</span><span class="function">open</span><span class="brackets">(</span><span class="string">"output.txt"</span><span class="brackets">,</span> <span class="string">"write"</span><span class="brackets">);</span></pre>
                    <p>Разберём:</p>
                    <ul>
                        <li><code>file.ostream</code> — тип объекта «поток вывода в файл»;</li>
                        <li><code>fout</code> — имя этого объекта (можно любое);</li>
                        <li><code>file.open()</code> — функция для открытия файла;</li>
                        <li><code>"output.txt"</code> — имя файла (создастся, если не существует);</li>
                        <li><code>"write"</code> — режим открытия: запись.</li>
                    </ul>
                </div>
                <div class="example">
                    <h2>Запись данных: выполнение</h2>
                    <p>После открытия файла можно записывать в него строки с помощью метода <code>write_line()</code>:</p>
                    <pre><span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Привет, мир!"</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
<span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Сейчас "</span><span class="brackets">,</span> <span class="number">2025</span><span class="brackets">,</span> <span class="string">" год"</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
<span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Файл создан с помощью Idyllium!"</span><span class="brackets">);</span></pre>
                    <p>Метод <code>write_line()</code> работает точно так же, как <code>console.write()</code> — принимает любое количество аргументов и собирает из них строку.</p>
                    <p>Перенос строки нужно указывать вручную (через <code>'\n'</code>), как и в консоли.</p>
                </div>
                <div class="example">
                    <h2>Завершение записи</h2>
                    <p>После завершения записи обязательно нужно закрыть файл:</p>
                    <pre><span class="object">fout</span><span class="brackets">.</span><span class="function">close</span><span class="brackets">();</span></pre>
                    <p>Это гарантирует, что все данные будут записаны на диск и файл не останется «зависшим».</p>
                </div>
                <div class="example">
                    <h2>Запись данных: полный пример</h2>
                    <pre><span class="keyword">use</span> <span class="object">file</span><span class="brackets">;</span>

<span class="function">main</span><span class="brackets">()</span> <span class="brackets">{</span>
    <span class="object">file</span><span class="brackets">.</span><span class="className">ostream</span> <span class="object">fout</span> <span class="brackets">=</span> <span class="object">file</span><span class="brackets">.</span><span class="function">open</span><span class="brackets">(</span><span class="string">"output.txt"</span><span class="brackets">,</span> <span class="string">"write"</span><span class="brackets">);</span>
    <span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Привет, мир!"</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
    <span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Сейчас "</span><span class="brackets">,</span> <span class="number">2025</span><span class="brackets">,</span> <span class="string">" год"</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
    <span class="object">fout</span><span class="brackets">.</span><span class="function">write_line</span><span class="brackets">(</span><span class="string">"Файл создан с помощью Idyllium!"</span><span class="brackets">);</span>
    <span class="object">fout</span><span class="brackets">.</span><span class="function">close</span><span class="brackets">();</span>
<span class="brackets">}</span></pre>
                    <p>При выполнении данной программы появится файл <code>output.txt</code> со следующим содержимым:</p>
                    <div class="file">Привет, мир!
Сейчас 2025 год
Файл создан с помощью Idyllium!</div>
                </div>
                <div class="example">
                    <h2>Открытие файла для чтения</h2>
                    <p>Чтобы прочитать файл, его нужно открыть в режиме <code>"read"</code>:</p>
                    <pre><span class="object">file</span><span class="brackets">.</span><span class="className">istream</span> <span class="object">fin</span> <span class="brackets">=</span> <span class="object">file</span><span class="brackets">.</span><span class="function">open</span><span class="brackets">(</span><span class="string">"input.txt"</span><span class="brackets">,</span> <span class="string">"read"</span><span class="brackets">);</span></pre>
                    <p>Здесь:</p>
                    <ul>
                        <li><code>file.istream</code> — тип «поток ввода из файла»;</li>
                        <li><code>fin</code> — имя объекта;</li>
                        <li><code>file.open()</code> — функция для открытия файла;</li>
                        <li><code>"input.txt"</code> — имя существующего файла;</li>
                        <li><code>"read"</code> — режим: чтение.</li>
                    </ul>
                    <p>Если файла не существует — программа выдаст ошибку.</p>
                </div>
                <div class="example">
                    <h2>Чтение файла построчно</h2>
                    <p>Возьмём файл с тремя строками:</p>
                    <div class="file">Кирка
Топор
Меч</div>
                    <p>Прочитаем его вручную:</p>
                    <pre><span class="keyword">use</span> <span class="object">console</span><span class="brackets">;</span>
<span class="keyword">use</span> <span class="object">file</span><span class="brackets">;</span>

<span class="function">main</span><span class="brackets">()</span> <span class="brackets">{</span>
    <span class="object">file</span><span class="brackets">.</span><span class="className">istream</span> <span class="object">fin</span> <span class="brackets">=</span> <span class="object">file</span><span class="brackets">.</span><span class="function">open</span><span class="brackets">(</span><span class="string">"input.txt"</span><span class="brackets">,</span> <span class="string">"read"</span><span class="brackets">);</span>
    <span class="typeName">string</span> <span class="object">line1</span> <span class="brackets">=</span> <span class="object">fin</span><span class="brackets">.</span><span class="function">read_line</span><span class="brackets">();</span> <span class="comment">// "Кирка\n"</span>
    <span class="typeName">string</span> <span class="object">line2</span> <span class="brackets">=</span> <span class="object">fin</span><span class="brackets">.</span><span class="function">read_line</span><span class="brackets">();</span> <span class="comment">// "Топор\n"</span>
    <span class="typeName">string</span> <span class="object">line3</span> <span class="brackets">=</span> <span class="object">fin</span><span class="brackets">.</span><span class="function">read_line</span><span class="brackets">();</span> <span class="comment">// "Меч"</span>
    <span class="object">fin</span><span class="brackets">.</span><span class="function">close</span><span class="brackets">();</span>

    <span class="typeName">array</span><span class="brackets">&lt;</span><span class="typeName">string</span><span class="brackets">,</span> <span class="number">3</span><span class="brackets">&gt;</span> <span class="object">t</span> <span class="brackets">=</span> <span class="brackets">[</span><span class="object">line1</span><span class="brackets">,</span> <span class="object">line2</span><span class="brackets">,</span> <span class="object">line3</span><span class="brackets">];</span>
    <span class="object">console</span><span class="brackets">.</span><span class="function">write</span><span class="brackets">(</span><span class="object">t</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
<span class="brackets">}</span></pre>
                    <div class="output">["Кирка\n", "Топор\n", "Меч"]</div>
                    <p>Здесь возникают две проблемы:</p>
                    <ol>
                        <li>Строки содержат символ <code>'\n'</code> (кроме последней);</li>
                        <li>Нельзя так читать файл, если количество строк заранее неизвестно.</li>
                    </ol>
                </div>
                <div class="example">
                    <h2>Очистка строки: метод <code>.simplify()</code></h2>
                    <p>Метод <code>.simplify()</code> удаляет управляющие символы (вроде <code>'\n'</code>, <code>'\t'</code>) из строки:</p>
                    <pre><span class="keyword">use</span> <span class="object">console</span><span class="brackets">;</span>

<span class="function">main</span><span class="brackets">()</span> <span class="brackets">{</span>
    <span class="typeName">array</span><span class="brackets">&lt;</span><span class="typeName">string</span><span class="brackets">,</span> <span class="number">3</span><span class="brackets">&gt;</span> <span class="object">raw</span> <span class="brackets">=</span> <span class="brackets">[</span><span class="string">"Кирка\n"</span><span class="brackets">,</span> <span class="string">"Топор\n"</span><span class="brackets">,</span> <span class="string">"Меч"</span><span class="brackets">];</span>
    <span class="typeName">array</span><span class="brackets">&lt;</span><span class="typeName">string</span><span class="brackets">,</span> <span class="number">3</span><span class="brackets">&gt;</span> <span class="object">clean</span><span class="brackets">;</span>

    <span class="keyword">for</span> <span class="brackets">(</span><span class="typeName">int</span> <span class="object">i</span> <span class="brackets">=</span> <span class="number">0</span><span class="brackets">;</span> <span class="object">i</span> <span class="brackets">&lt;</span> <span class="number">3</span><span class="brackets">;</span> <span class="object">i</span> <span class="brackets">=</span> <span class="object">i</span> <span class="brackets">+</span> <span class="number">1</span><span class="brackets">)</span> <span class="brackets">{</span>
        <span class="object">clean</span><span class="brackets">[</span><span class="object">i</span><span class="brackets">]</span> <span class="brackets">=</span> <span class="object">raw</span><span class="brackets">[</span><span class="object">i</span><span class="brackets">].</span><span class="function">simplify</span><span class="brackets">();</span>
    <span class="brackets">}</span>

    <span class="object">console</span><span class="brackets">.</span><span class="function">write</span><span class="brackets">(</span><span class="object">clean</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
<span class="brackets">}</span></pre>
                    <div class="output">["Кирка", "Топор", "Меч"]</div>
                    <p>Теперь строки «чистые» и готовы к использованию.</p>
                </div>
                <div class="example">
                    <h2>Чтение файла неизвестной длины</h2>
                    <p>Метод <code>.has_next_line()</code> у объектов типа <code>istream</code> возвращает <code>true</code>, если в файле ещё есть строки:</p>
                    <pre><span class="keyword">while</span> <span class="brackets">(</span><span class="object">fin</span><span class="brackets">.</span><span class="function">has_next_line</span><span class="brackets">())</span> <span class="brackets">{</span>
    <span class="typeName">string</span> <span class="object">one_line</span> <span class="brackets">=</span> <span class="object">fin</span><span class="brackets">.</span><span class="function">read_line</span><span class="brackets">();</span>
<span class="brackets">}</span></pre>
                    <p>Такой цикл прочитает файл целиком — независимо от количества строк.</p>
                </div>
                <div class="example">
                    <h2>Полный пример: чтение и очистка файла</h2>
                    <pre><span class="keyword">use</span> <span class="object">console</span><span class="brackets">;</span>
<span class="keyword">use</span> <span class="object">file</span><span class="brackets">;</span>

<span class="function">main</span><span class="brackets">()</span> <span class="brackets">{</span>
    <span class="typeName">dyn_array</span><span class="brackets">&lt;</span><span class="typeName">string</span><span class="brackets">&gt;</span> <span class="object">lines</span><span class="brackets">;</span>

    <span class="comment">// 1. Открываем файл "input.txt" для чтения</span>
    <span class="object">file</span><span class="brackets">.</span><span class="className">istream</span> <span class="object">fin</span> <span class="brackets">=</span> <span class="object">file</span><span class="brackets">.</span><span class="function">open</span><span class="brackets">(</span><span class="string">"input.txt"</span><span class="brackets">,</span> <span class="string">"read"</span><span class="brackets">);</span>

    <span class="comment">// 2. Пока в файле есть строки — читаем их</span>
    <span class="keyword">while</span> <span class="brackets">(</span><span class="object">fin</span><span class="brackets">.</span><span class="function">has_next_line</span><span class="brackets">())</span> <span class="brackets">{</span>
        <span class="typeName">string</span> <span class="object">one_line</span> <span class="brackets">=</span> <span class="object">fin</span><span class="brackets">.</span><span class="function">read_line</span><span class="brackets">();</span>
        <span class="typeName">string</span> <span class="object">fixed_line</span> <span class="brackets">=</span> <span class="object">one_line</span><span class="brackets">.</span><span class="function">simplify</span><span class="brackets">();</span>
        <span class="object">lines</span><span class="brackets">.</span><span class="function">add</span><span class="brackets">(</span><span class="object">fixed_line</span><span class="brackets">);</span>
    <span class="brackets">}</span>

    <span class="comment">// 3. Обязательно закрываем файл</span>
    <span class="object">fin</span><span class="brackets">.</span><span class="function">close</span><span class="brackets">();</span>

    <span class="object">console</span><span class="brackets">.</span><span class="function">write</span><span class="brackets">(</span><span class="object">lines</span><span class="brackets">,</span> <span class="string">'\n'</span><span class="brackets">);</span>
<span class="brackets">}</span></pre>
                    <p>При входном файле:</p>
                    <div class="file">Кирка
Топор
Меч</div>
                    <p>Программа выведет:</p>
                    <div class="output">["Кирка", "Топор", "Меч"]</div>
                    <p>Теперь вы можете читать любые текстовые файлы — сколько бы в них ни было строк.</p>
                </div>
                <div class="example">
                    <div class="lesson-nav">
                        <a href="./lesson22.html" class="nav-button nav-prev">
                            ← Урок 22: Создание собственных библиотек
                        </a>
                        <a href="./lesson24.html" class="nav-button nav-next">
                            Урок 24: Продвинутые возможности 'math' →
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <p class="subtitle">Maintaining just for lulz</p>
        <div style="text-align: center;"><span class="copyright">©</span>2025-∞</div>
    </footer>
    <script src="./common.js" defer></script>
</body>
</html>